<html>
	<head>
		<script type="text/javascript" src="jquery-1.6.2.min.js"></script>
		<script type="text/javascript" src="phonegap-1.1.0.js"></script>
		<script type="text/javascript" src="plugin_billing.js"></script>
		<script type="text/javascript">
		var start = false;
		
		function requestPurchase() {
			console.log('CALL REQUEST PURCHASE');
			
			var productId = $('#items').val();
			alert(productId);
			
			window.plugins.CallbackBillingPlugin.requestPurchase(
				function(s) {
					var data = $.parseJSON(s);
					$('#log').append('<p>requestPurchase: SUCCEED</p>');
					$('#log').append('<p>requestPurchase: '+ data.event +'</p>');
					if (data.event == 'onRequestPurchaseResponse') {
						$('#log').append('<p> productId = '+ data.productId +'</p>');
						$('#log').append('<p> responseCode = '+ data.responseCode +'</p>');
					} else if (data.event == 'onPurchaseStateChange') {
						$('#log').append('<p> purchaseState = '+ data.purchaseState +'</p>');
					}
				},
				function(f) {
					$('#log').append('<p>requestPurchase: FAILED</p>');
				},
				productId
			);
		}
		
		function getPurchasedItems() {
			console.log('CALL GET PURCHASED ITEMS');
			window.plugins.CallbackBillingPlugin.getPurchasedItems(
				function(s) {
					console.log('succeed');
					var data = $.parseJSON(s);
					$('#log').append('<p>getPurchasedItems: status = ' + data.status + '</p>');
					if (data.status == 'OK') {
						var update = '';
				        $.each(data.result, function(index, item) {
				            update += item.productId + '('+ item.quantity +')';
				            update += '<br />';
				        });
					} else if (data.status == 'NO_RESULT') {
						update = 'No owned items found';
					}
					$('#log').append(update);
				},
				function(f) {
					console.log('failed');
					$('#log').append('<p>getPurchasedItems: FAILED</p>');
					$('#log').append('<p>getPurchasedItems: '+ f +'</p>');
				}
			);
		}
		
		function restoreDatabase() {
			console.log('CALL RESTORE DATABASE');
			window.plugins.CallbackBillingPlugin.restoreDatabase(
				function(s) {
					console.log('restoreDatabase: succeed');
					$('#log').append('<p>restoreDatabase: SUCCEED</p>');
				},
				function(f) {
					console.log('restoreDatabase: failed');
					$('#log').append('<p>restoreDatabase: FAILED</p>');
				}
			);
		}
		
		document.addEventListener("deviceready", onDeviceReady, false);

	    // PhoneGap is ready
	    //
	    function onDeviceReady() {
	    	console.log('device ready');
	    	
			//document.addEventListener("onPurchaseStateChange", onPurchaseStateChange, false);

			//document.addEventListener("onRequestPurchaseResponse", onRequestPurchaseResponse, false);

			//document.addEventListener("onRestoreTransactionsResponse", onRestoreTransactionsResponse, false);
			
	    	restoreDatabase();
	    }
	    
	    function onPurchaseStateChange(result) {
	    	console.log('======== onPurchaseStateChange ===========');
	    	console.log(result);
	    	return 1;
	    }

	    function onRequestPurchaseResponse(result) {
	    	console.log('======== onRequestPurchaseResponse ===========');
	    	console.log(result);
	    	return 1;
	    }

	    function onRestoreTransactionsResponse(result) {
	    	console.log('======== onRestoreTransactionsResponse ===========');
	    	console.log(result);
	    	
	    	return 1;
	    }

	    function callTest() {
			window.plugins.CallbackBillingPlugin.test(
				function(s) {
					console.log('restoreDatabase: succeed');
				},
				function(f) {
					console.log('restoreDatabase: failed');
				}
			);
	    }
	    
	    function test() {
	    	console.log("THIS IS A TEST MESSAGE");
	    }
	    </script>
	</head>
	<body>
		<p>This is phonegap</p>
		<input type="button" name="Buy" value="Buy" onclick="requestPurchase();"/>
		<select name="items" id="items">
			<option value="android.test.purchased">Purchased</option>
			<option value="android.test.canceled">Canceled</option>
			<option value="android.test.refunded">Refunded</option>
			<option value="android.test.item_unavailable">Unavailable</option>
		</select>
		<input type="button" name="List" value="List" onclick="getPurchasedItems();"/>
		
		<input type="button" name="test" value="TEST" onclick="callTest();"/>
		<div id="log"></div>
	</body>
</html>